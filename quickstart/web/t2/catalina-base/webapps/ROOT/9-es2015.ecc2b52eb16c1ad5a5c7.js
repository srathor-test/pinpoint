(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"/n0m":function(t,e,n){"use strict";var i,a;n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s})),function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.META=2]="META",t[t.TRANSACTION_ID=3]="TRANSACTION_ID",t[t.TYPE=4]="TYPE",t[t.GROUP_COUNT=5]="GROUP_COUNT"}(i||(i={})),function(t){t[t.AGENT_NAME=0]="AGENT_NAME",t[t.TRANSACTION_PREFIX_1=1]="TRANSACTION_PREFIX_1",t[t.TRANSACTION_PREFIX_2=2]="TRANSACTION_PREFIX_2"}(a||(a={}));class s{constructor(t,e){this.originalData=t,this.typeManager=e,this.agentList=[],this.transactionDataByAgent={},this.countByType={},this.initVariable(),this.initInnerDataStructure(),this.classifyDataByAgent()}initVariable(){this.from=this.originalData.from,this.to=this.originalData.to,this.originalData.complete?(this.fromX=this.originalData.from,this.toX=this.originalData.to):(this.fromX=this.originalData.resultFrom,this.toX=this.originalData.resultTo),this.agentMetadata=this.originalData.scatter.metadata,this.transactionData=[]}initInnerDataStructure(){Object.keys(this.agentMetadata).forEach(t=>{const e=this.agentMetadata[t][a.AGENT_NAME];this.transactionDataByAgent[e]=[],this.countByType[e]={},this.typeManager.getTypeNameList().forEach(t=>{this.countByType[e][t]=0}),-1===this.agentList.indexOf(e)&&this.agentList.push(e)}),this.agentList.sort()}classifyDataByAgent(){this.originalData.scatter.dotList.forEach(t=>{const e=this.getAgentName(t),n=this.typeManager.getNameByIndex(t[i.TYPE]),a=t.concat();a[i.X]+=this.from,this.transactionData.push(a),this.transactionDataByAgent[e].push(a),this.countByType[e][n]++})}getAgentName(t){return"string"==typeof t?this.agentMetadata[t][a.AGENT_NAME]:this.agentMetadata[t[i.META]][a.AGENT_NAME]}getDataByAgentAndIndex(t,e){return this.transactionDataByAgent[t][e]}getGroupCount(t){return t[i.GROUP_COUNT]}getDataByIndex(t){return this.transactionData[t]}getTotalCount(){return this.transactionData.length}countByAgent(t){return this.transactionDataByAgent[t]?this.transactionDataByAgent[t].length:0}getCount(t,e,n,i){if(n&&i)return this.getCountOfRange(t,e,n,i);if(""===t){let t=0;return Object.keys(this.countByType).forEach(n=>{t+=this.countByType[n][e]}),t}return this.countByType[t]?this.countByType[t][e]:0}getCountOfRange(t,e,n,a){let s=0;const o=this.transactionDataByAgent[t].length;if(this.fromX>=a||this.toX<=n||0===o||t in this.countByType==!1)return s;if(this.fromX>=n&&this.toX<=a)return this.getCount(t,e);for(let r=0;r<o;r++){const o=this.transactionDataByAgent[t][r];if(o[i.X]<n)break;e===this.typeManager.getNameByIndex(o[i.TYPE])&&o[i.X]<=a&&s++}return s}getTransactionID(t){const e=this.agentMetadata[t[i.META]];return`${e[a.TRANSACTION_PREFIX_1]}^${e[a.TRANSACTION_PREFIX_2]}^${t[i.TRANSACTION_ID]}`}getX(t){return t[i.X]}getY(t){return t[i.Y]}getTypeIndex(t){return t[i.TYPE]}getXRange(){return{from:this.fromX,to:this.toX}}isEmpty(){return 0===this.transactionData.length}getAgentList(){return this.agentList}}},"7fKh":function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("8Y7J"),a=n("REft");class s{constructor(){this.outChanged=new i.EventEmitter}ngOnInit(){this.transactionTypeInfo=a.a.getDefaultTransactionTypeInfo(),this.sortTypeInfo()}ngOnChanges(t){this.transactionTypeCount&&this.transactionTypeInfo&&Object.keys(this.transactionTypeCount).forEach(t=>{this.transactionTypeInfo[t].checked=this.transactionTypeCount[t].checked})}sortTypeInfo(){this.sortedKeyArr=[];const t=[];Object.keys(this.transactionTypeInfo).forEach(e=>{t.push(this.transactionTypeInfo[e])}),t.sort((t,e)=>t.order-e.order).forEach(t=>{this.sortedKeyArr.push(t.name)})}upperFirstChar(t){return t?t.substr(0,1).toUpperCase()+t.substr(1):""}getTypeCount(t){return this.transactionTypeCount&&this.transactionTypeCount[t]?this.transactionTypeCount[t].count:0}onCheck(t){this.transactionTypeInfo[t].checked=!this.transactionTypeInfo[t].checked,this.outChanged.emit({instanceKey:this.instanceKey,name:t,checked:this.transactionTypeInfo[t].checked})}}},Ea0K:function(t,e,n){"use strict";var i=n("8Y7J"),a=n("hNim");n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return r}));var s=[["[_nghost-%COMP%]{width:100%;z-index:1000;position:absolute}.l-chart-setting[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-flow:column;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;width:60%;border:1px solid #e5e8f0;text-align:left;box-shadow:1px 1px 10px rgba(0,0,0,.15);background:#fff;margin:15% 20%}.l-title-group[_ngcontent-%COMP%]{height:auto;padding:10px 20px;background-color:#fff}.l-title-group[_ngcontent-%COMP%]   dt[_ngcontent-%COMP%]{color:var(--primary-color);font-size:20px;font-weight:600}.l-contents-group[_ngcontent-%COMP%]{padding:20px 20px 15px}.l-contents-group[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:5px 0 0;font-size:13px;font-weight:600}.l-contents-group[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:50%;display:inline-block}.l-contents-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:1px solid #d7dde4;font-size:13px;color:#666;height:22px;padding:0 8px}.l-bottom-group[_ngcontent-%COMP%]{text-align:center;margin:0 0 20px}input[_ngcontent-%COMP%]{color:#666;width:40%;height:22px;border:1px solid #d7dde4;padding:0 8px;font-size:13px}"]],o=i["\u0275crt"]({encapsulation:0,styles:s,data:{}});function r(t){return i["\u0275vid"](0,[i["\u0275qud"](402653184,1,{minInput:0}),i["\u0275qud"](402653184,2,{maxInput:0}),(t()(),i["\u0275eld"](2,0,null,null,19,"article",[["class","l-chart-setting"]],null,null,null,null,null)),(t()(),i["\u0275eld"](3,0,null,null,3,"div",[["class","l-title-group"]],null,null,null,null,null)),(t()(),i["\u0275eld"](4,0,null,null,2,"dl",[],null,null,null,null,null)),(t()(),i["\u0275eld"](5,0,null,null,1,"dt",[],null,null,null,null,null)),(t()(),i["\u0275ted"](-1,null,["Setting"])),(t()(),i["\u0275eld"](7,0,null,null,9,"div",[["class","l-contents-group"]],null,null,null,null,null)),(t()(),i["\u0275eld"](8,0,null,null,8,"ul",[],null,null,null,null,null)),(t()(),i["\u0275eld"](9,0,null,null,3,"li",[],null,null,null,null,null)),(t()(),i["\u0275eld"](10,0,null,null,1,"label",[],null,null,null,null,null)),(t()(),i["\u0275ted"](-1,null,["Min of Y axis"])),(t()(),i["\u0275eld"](12,0,[[1,0],["minInput",1]],null,0,"input",[["min","0"],["type","number"]],[[8,"value",0]],null,null,null,null)),(t()(),i["\u0275eld"](13,0,null,null,3,"li",[],null,null,null,null,null)),(t()(),i["\u0275eld"](14,0,null,null,1,"label",[],null,null,null,null,null)),(t()(),i["\u0275ted"](-1,null,["Max of Y axis"])),(t()(),i["\u0275eld"](16,0,[[2,0],["maxInput",1]],null,0,"input",[["min","0"],["type","number"]],[[8,"value",0]],null,null,null,null)),(t()(),i["\u0275eld"](17,0,null,null,4,"div",[["class","l-bottom-group"]],null,null,null,null,null)),(t()(),i["\u0275eld"](18,0,null,null,1,"button",[["class","active btn"]],null,[[null,"click"]],(function(t,e,n){var i=!0,a=t.component;"click"===e&&(i=!1!==a.onApply()&&i);return i}),null,null)),(t()(),i["\u0275ted"](-1,null,["Apply"])),(t()(),i["\u0275eld"](20,0,null,null,1,"button",[["class","btn"]],null,[[null,"click"]],(function(t,e,n){var i=!0,a=t.component;"click"===e&&(i=!1!==a.onCancel()&&i);return i}),null,null)),(t()(),i["\u0275ted"](-1,null,["Cancel"]))],null,(function(t,e){var n=e.component;t(e,12,0,i["\u0275inlineInterpolate"](1,"",n.min,"")),t(e,16,0,i["\u0275inlineInterpolate"](1,"",n.max,""))}))}i["\u0275ccf"]("pp-scatter-chart-setting-popup",a.a,(function(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,1,"pp-scatter-chart-setting-popup",[],null,null,null,r,o)),i["\u0275did"](1,114688,null,0,a.a,[],null,null)],(function(t,e){t(e,1,0)}),null)}),{instanceKey:"instanceKey",min:"min",max:"max"},{outApply:"outApply",outCancel:"outCancel"},[])},"O/DK":function(t,e,n){"use strict";var i=n("8Y7J"),a=n("SVse"),s=n("dryN"),o=n("OsX8"),r=n("zw4y");n.d(e,"a",(function(){return h})),n.d(e,"b",(function(){return d}));var l=[["[_nghost-%COMP%]{display:block;height:100%}.l-wrapper[_ngcontent-%COMP%]{display:block}.l-scatter[_ngcontent-%COMP%]{width:100%;height:100%;display:block;position:relative}.l-message[_ngcontent-%COMP%]{top:0;width:100%;height:100%;display:-webkit-box;display:flex;position:absolute;text-align:center;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center}.l-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600}canvas[_ngcontent-%COMP%]{width:100%;height:100%}"]],h=i["\u0275crt"]({encapsulation:0,styles:l,data:{}});function c(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,2,"div",[["class","l-message"]],null,null,null,null,null)),(t()(),i["\u0275eld"](1,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),i["\u0275ted"](-1,null,["Loading..."]))],null,null)}function u(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,2,"div",[["class","l-message"]],null,null,null,null,null)),(t()(),i["\u0275eld"](1,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),i["\u0275ted"](2,null,["",""]))],null,(function(t,e){t(e,2,0,e.component.getMessage())}))}function d(t){return i["\u0275vid"](0,[i["\u0275qud"](402653184,1,{elementScatter:0}),(t()(),i["\u0275eld"](1,0,null,null,5,"div",[["class","l-wrapper"]],null,null,null,null,null)),(t()(),i["\u0275eld"](2,0,[[1,0],["scatter",1]],null,0,"div",[["class","l-scatter"]],null,null,null,null,null)),(t()(),i["\u0275and"](16777216,null,null,1,null,c)),i["\u0275did"](4,16384,null,0,a.NgIf,[i.ViewContainerRef,i.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),i["\u0275and"](16777216,null,null,1,null,u)),i["\u0275did"](6,16384,null,0,a.NgIf,[i.ViewContainerRef,i.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(t,e){var n=e.component;t(e,4,0,!n.dataLoaded),t(e,6,0,!n.hideNoData())}),null)}i["\u0275ccf"]("pp-scatter-chart",s.a,(function(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,1,"pp-scatter-chart",[],null,null,null,d,h)),i["\u0275did"](1,770048,null,0,s.a,[o.a,r.a],null,null)],(function(t,e){t(e,1,0)}),null)}),{instanceKey:"instanceKey",addWindow:"addWindow",width:"width",height:"height",fromX:"fromX",toX:"toX",fromY:"fromY",toY:"toY",mode:"mode",application:"application",agent:"agent",i18nText:"i18nText",timezone:"timezone",dateFormat:"dateFormat"},{outTransactionCount:"outTransactionCount",outSelectArea:"outSelectArea",outChangeRangeX:"outChangeRangeX"},[])},R0vR:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var i=n("IheW"),a=n("XNiG"),s=n("jtHE"),o=n("LRne"),r=n("eIep"),l=n("un/a"),h=n("pLZG"),c=n("3E0/"),u=n("ueBd");class d{constructor(t){this.http=t,this.url="getScatterData.pinpoint",this.realtime={interval:2e3,resetTimeGap:2e4},this.loadStart=!0,this.innerDataRequest=new a.b,this.innerRealTimeDataRequest=new a.b,this.outScatterData=new a.b,this.savedScatterData=new s.a,this.outRealTimeScatterData=new a.b,this.outScatterErrorData=new a.b,this.outRealTimeScatterErrorData=new a.b,this.outScatterData$=this.outScatterData.asObservable(),this.outScatterErrorData$=this.outScatterErrorData.asObservable(),this.outRealTimeScatterData$=this.outRealTimeScatterData.asObservable(),this.outRealTimeScatterErrorData$=this.outRealTimeScatterErrorData.asObservable(),this.savedScatterData$=this.savedScatterData.asObservable(),this.connectDataRequest()}connectDataRequest(){this.innerDataRequest.pipe(Object(r.a)(t=>this.requestHttp(t).pipe(Object(l.a)(3),Object(h.a)(t=>!Object(u.c)(t,"exception"))))).subscribe(t=>{this.subscribeStaticRequest(t)},t=>{this.outScatterErrorData.next(t)}),this.innerRealTimeDataRequest.pipe(Object(h.a)(()=>this.loadStart),Object(r.a)(t=>this.requestHttp(t).pipe(Object(l.a)(3)))).subscribe(t=>{this.subscribeRealTimeRequest(t)},t=>{})}requestHttp(t){return this.http.get(this.url,this.makeRequestOptionsArgs(t.application,t.fromX,t.toX,t.groupUnitX,t.groupUnitY,t.backwardDirection))}getData(t,e,n){this.requestTime=Date.now();const i={application:this.application,fromX:t,toX:e,groupUnitX:this.groupUnitX,groupUnitY:this.groupUnitY,backwardDirection:n};return this.innerDataRequest.next(i)}getRealTimeData(t,e,n){this.requestTime=Date.now();const i={application:this.application,fromX:t,toX:e,groupUnitX:this.groupUnitX,groupUnitY:this.groupUnitY,backwardDirection:n};return this.innerRealTimeDataRequest.next(i)}loadData(t,e,n,i,a,o){this.application=t,this.groupUnitX=i,this.groupUnitY=a,!1!==o&&(this.savedScatterData.complete(),this.savedScatterData=new s.a,this.savedScatterData$=this.savedScatterData.asObservable()),this.getData(e,n,!0)}subscribeStaticRequest(t){this.savedScatterData.next(t),this.outScatterData.next(t)}getSavedData(){return this.savedScatterData$}loadRealTimeData(t,e,n,i,a){this.loadStart=!0,this.application=t,this.groupUnitX=i,this.groupUnitY=a}loadRealTimeDataV2(t){this.loadStart=!0,Object(o.a)(1).pipe(Object(c.a)(this.realtime.interval)).subscribe(e=>{this.getRealTimeData(t,t+this.realtime.interval,!1)})}stopLoad(){this.loadStart=!1}isConnected(){return this.loadStart}subscribeRealTimeRequest(t){const e=Date.now()-this.requestTime;let n=0,i=0,a=this.realtime.interval-e;if(t.complete)if(n=t.to,i=n+this.realtime.interval,a>0){const e=t.currentServerTime-i;e>=a&&(a=e>=this.realtime.interval?0:Math.min(Math.abs(e),a))}else a=0;else n=t.from,i=t.resultFrom,a=0;t.currentServerTime-i>=this.realtime.resetTimeGap?(t.reset=!0,this.outRealTimeScatterData.next(t)):(this.outRealTimeScatterData.next(t),Object(o.a)(1).pipe(Object(c.a)(a)).subscribe(t=>{this.getRealTimeData(n,i,!1)}))}makeRequestOptionsArgs(t,e,n,a,s,o){return{params:(new i.h).set("application",t).set("from",e+"").set("to",n+"").set("limit","5000").set("filter","").set("xGroupUnit",a+"").set("yGroupUnit",s+"").set("backwardDirection",o+"")}}}},R4Tc:function(t,e,n){"use strict";var i=n("8Y7J"),a=n("SVse"),s=n("7fKh");n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return h}));var o=[["[_nghost-%COMP%]{display:block}.l-checkbox-group[_ngcontent-%COMP%]{color:#b3b3b4;margin:24px 0 0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;font-size:12px;justify-content:space-around}.l-checkbox-group[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#333;font-size:22px}.l-checkbox-group[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]:before{width:13px;height:13px;margin:0 6px 0 0;content:'';display:inline-block;background:#34b994;border-radius:50%}.l-checkbox-group[_ngcontent-%COMP%]   .failed[_ngcontent-%COMP%]:before{width:13px;height:13px;margin:0 6px 0 0;content:'';display:inline-block;background:#e95459;border-radius:50%}input[_ngcontent-%COMP%]{margin-left:10px}"]],r=i["\u0275crt"]({encapsulation:0,styles:o,data:{}});function l(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,6,"div",[],[[8,"className",0]],null,null,null,null)),(t()(),i["\u0275eld"](1,0,null,null,4,"label",[],[[8,"htmlFor",0]],null,null,null,null)),(t()(),i["\u0275ted"](2,null,[" "," "])),(t()(),i["\u0275eld"](3,0,null,null,2,"span",[],null,null,null,null,null)),(t()(),i["\u0275ted"](4,null,["",""])),i["\u0275ppd"](5,1),(t()(),i["\u0275eld"](6,0,null,null,0,"input",[["type","checkbox"]],[[8,"id",0],[8,"checked",0],[8,"value",0]],[[null,"change"]],(function(t,e,n){var i=!0,a=t.component;"change"===e&&(i=!1!==a.onCheck(t.context.$implicit)&&i);return i}),null,null))],null,(function(t,e){var n=e.component;t(e,0,0,i["\u0275inlineInterpolate"](1,"",e.context.$implicit,"")),t(e,1,0,i["\u0275inlineInterpolate"](1,"",e.context.$implicit,"-id")),t(e,2,0,n.upperFirstChar(e.context.$implicit));var a=i["\u0275unv"](e,4,0,t(e,5,0,i["\u0275nov"](e.parent,0),n.getTypeCount(e.context.$implicit)));t(e,4,0,a),t(e,6,0,i["\u0275inlineInterpolate"](1,"",e.context.$implicit,"-id"),n.transactionTypeInfo[e.context.$implicit].checked,i["\u0275inlineInterpolate"](1,"",e.context.$implicit,""))}))}function h(t){return i["\u0275vid"](0,[i["\u0275pid"](0,a.DecimalPipe,[i.LOCALE_ID]),(t()(),i["\u0275eld"](1,0,null,null,2,"div",[["class","l-checkbox-group"]],null,null,null,null,null)),(t()(),i["\u0275and"](16777216,null,null,1,null,l)),i["\u0275did"](3,278528,null,0,a.NgForOf,[i.ViewContainerRef,i.TemplateRef,i.IterableDiffers],{ngForOf:[0,"ngForOf"]},null)],(function(t,e){t(e,3,0,e.component.sortedKeyArr)}),null)}i["\u0275ccf"]("pp-scatter-chart-state-view",s.a,(function(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,1,"pp-scatter-chart-state-view",[],null,null,null,h,r)),i["\u0275did"](1,638976,null,0,s.a,[],null,null)],(function(t,e){t(e,1,0)}),null)}),{instanceKey:"instanceKey",transactionTypeCount:"transactionTypeCount"},{outChanged:"outChanged"},[])},REft:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));class i{constructor(t){this.transactionTypeInfo=t,this.dataByIndex={},this.dataByName={},this.initData()}static getTypeCheckValue(t,e){return t?{name:"success",checked:!1}:e?{name:"failed",checked:!1}:void 0}static getDefaultTransactionTypeInfo(){return{success:{name:"success",order:10,color:"#34B994",checked:!0,dataIndex:1},failed:{name:"failed",order:20,color:"#E95459",checked:!0,dataIndex:0}}}initData(){Object.keys(this.transactionTypeInfo).forEach(t=>{const e=Object.assign({},this.transactionTypeInfo[t]);this.dataByName[t]=e,this.dataByIndex[e.dataIndex]=e})}reset(){this.initData()}getTypeNameList(){return Object.keys(this.dataByName)}setChecked(t,e){this.dataByName[t].checked=e}isCheckedByName(t){return this.dataByName[t].checked}isCheckedByIndex(t){return this.dataByIndex[t].checked}getColorByIndex(t){return this.dataByIndex[t].color}getColorByName(t){return this.dataByName[t].color}getNameByIndex(t){return this.dataByIndex[t].name}getCheckedTypeNameList(){const t=[];return Object.keys(this.dataByName).forEach(e=>{this.dataByName[e].checked&&t.push(e)}),t}}},dryN:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var i=n("8Y7J"),a=n("XNiG"),s=n("1G5W"),o=n("pLZG"),r=(n("ZF+8"),n("xvpG")),l=n("/n0m");n("zw4y");class h{constructor(t,e){this.windowRefService=t,this.scatterChartInteractionService=e,this.outTransactionCount=new i.EventEmitter,this.outSelectArea=new i.EventEmitter,this.outChangeRangeX=new i.EventEmitter,this.BLOCK_MAX_SIZE=500,this.unsubscribe=new a.b,this.hasError=!1,this.dataLoaded=!1,this.scatterChartInstance=null}ngOnInit(){}ngOnChanges(t){this.mode&&this.fromX>=0&&this.toX>=0&&this.fromY>=0&&this.toY>=0&&this.application&&this.timezone&&this.dateFormat&&(null===this.scatterChartInstance?(this.scatterChartInstance=new r.a(this.mode,this.elementScatter.nativeElement,this.fromX,this.toX,this.fromY,this.toY,this.application,this.agent,this.width,this.height,this.timezone,this.dateFormat),this.addSubscribeForInstance(),this.addSubscribeForService(),this.addToWindow()):(t.timezone&&t.timezone.currentValue&&(this.scatterChartInstance.setTimezone(this.timezone),this.scatterChartInstance.redraw()),t.dateFormat&&t.dateFormat.currentValue&&(this.scatterChartInstance.setDateFormat(this.dateFormat),this.scatterChartInstance.redraw())))}addToWindow(){this.addWindow&&("scatterChartInstance"in this.windowRefService.nativeWindow==!1&&(this.windowRefService.nativeWindow.scatterChartInstance={}),this.windowRefService.nativeWindow.scatterChartInstance[this.application]=this.scatterChartInstance)}addSubscribeForInstance(){this.scatterChartInstance.onSelect$.pipe(Object(s.a)(this.unsubscribe)).subscribe(t=>{this.outSelectArea.emit(t)}),this.scatterChartInstance.onChangeTransactionCount$.pipe(Object(s.a)(this.unsubscribe)).subscribe(t=>{this.outTransactionCount.emit(t)}),this.scatterChartInstance.onChangeRangeX$.pipe(Object(s.a)(this.unsubscribe)).subscribe(t=>{this.outChangeRangeX.emit(t)})}addSubscribeForService(){this.scatterChartInteractionService.onChartData$.pipe(Object(s.a)(this.unsubscribe),Object(o.a)(t=>t.instanceKey===this.instanceKey)).subscribe(t=>{const e=this.scatterChartInstance.getTypeManager(),n=t.data.scatter.dotList.length;if(n>this.BLOCK_MAX_SIZE){const i=t.data.from,a=t.data.to;let s=0,o=Math.min(n,this.BLOCK_MAX_SIZE)-1;do{this.scatterChartInstance.addData(new l.b({complete:!1,currentServerTime:t.data.currentServerTime,from:i,resultFrom:t.data.scatter.dotList[o][0]+i,resultTo:t.data.scatter.dotList[s][0]+i,scatter:{dotList:t.data.scatter.dotList.slice(s,o+1),metadata:t.data.scatter.metadata},to:a},e)),s=o+1,o=Math.min(n,s+this.BLOCK_MAX_SIZE)-1}while(s<n)}else this.scatterChartInstance.addData(new l.b(t.data,e));this.dataLoaded=!0,this.hasError=!1}),this.scatterChartInteractionService.onViewType$.pipe(Object(s.a)(this.unsubscribe),Object(o.a)(t=>t.instanceKey===this.instanceKey)).subscribe(t=>{this.scatterChartInstance.changeShowType(t)}),this.scatterChartInteractionService.onChangeYRange$.pipe(Object(s.a)(this.unsubscribe),Object(o.a)(t=>t.instanceKey===this.instanceKey)).subscribe(t=>{this.scatterChartInstance.changeYRange(t)}),this.scatterChartInteractionService.onSelectedAgent$.pipe(Object(s.a)(this.unsubscribe),Object(o.a)(t=>t.instanceKey===this.instanceKey)).subscribe(t=>{this.scatterChartInstance.changeSelectedAgent(t.agent)}),this.scatterChartInteractionService.onInvokeDownloadChart$.pipe(Object(s.a)(this.unsubscribe),Object(o.a)(t=>t===this.instanceKey)).subscribe(()=>{this.scatterChartInstance.downloadChartAsImage("png")}),this.scatterChartInteractionService.onReset$.pipe(Object(s.a)(this.unsubscribe),Object(o.a)(t=>t.instanceKey===this.instanceKey)).subscribe(t=>{this.hasError=!1,this.dataLoaded=!1,this.application=t.application,this.agent=t.agent,this.fromX=t.from,this.toX=t.to,this.mode=t.mode,this.scatterChartInstance.reset(t.application,t.agent,t.from,t.to,t.mode),this.addToWindow()}),this.scatterChartInteractionService.onError$.pipe(Object(s.a)(this.unsubscribe)).subscribe(t=>{this.hasError=!0,this.dataLoaded=!0,this.scatterChartInstance.reset(this.application,this.agent,this.fromX,this.toX,this.mode),this.addToWindow()})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}hideNoData(){return!1===this.dataLoaded||(this.mode===r.a.MODE.REALTIME||this.scatterChartInstance&&!this.scatterChartInstance.isEmpty())}getMessage(){return this.hasError?this.i18nText.FAILED_TO_FETCH_DATA:this.i18nText.NO_DATA}}},erdE:function(t,e,n){"use strict";var i=n("8Y7J"),a=n("hiii");n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return r}));var s=[[".l-tool-box[_ngcontent-%COMP%]{font-size:14px;color:#b3b5b9;text-align:right;position:relative;padding:0 25px}.l-tool-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 0 0 14px}.fas[_ngcontent-%COMP%], .l-tool-box[_ngcontent-%COMP%]   button.l-last-child[_ngcontent-%COMP%]{font-size:18px}"]],o=i["\u0275crt"]({encapsulation:0,styles:s,data:{}});function r(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,4,"div",[["class","l-tool-box"]],null,null,null,null,null)),(t()(),i["\u0275eld"](1,0,null,null,0,"button",[["class","fas fa-cog"]],[[8,"hidden",0]],[[null,"click"]],(function(t,e,n){var i=!0,a=t.component;"click"===e&&(i=!1!==a.outShowSetting.emit()&&i);return i}),null,null)),(t()(),i["\u0275eld"](2,0,null,null,0,"button",[["class","fas fa-download"]],[[8,"hidden",0]],[[null,"click"]],(function(t,e,n){var i=!0,a=t.component;"click"===e&&(i=!1!==a.outDownload.emit()&&i);return i}),null,null)),(t()(),i["\u0275eld"](3,0,null,null,0,"button",[["class","fas fa-expand-arrows-alt"]],[[8,"hidden",0]],[[null,"click"]],(function(t,e,n){var i=!0,a=t.component;"click"===e&&(i=!1!==a.outOpenScatterPage.emit()&&i);return i}),null,null)),(t()(),i["\u0275eld"](4,0,null,null,0,"button",[["class","fas fa-question-circle l-last-child"]],[[8,"hidden",0]],[[null,"click"]],(function(t,e,n){var i=!0,a=t.component;"click"===e&&(i=!1!==a.onShowHelp(n)&&i);return i}),null,null))],null,(function(t,e){var n=e.component;t(e,1,0,n.hiddenOptions.setting),t(e,2,0,n.hiddenOptions.download),t(e,3,0,n.hiddenOptions.open),t(e,4,0,n.hiddenOptions.help)}))}i["\u0275ccf"]("pp-scatter-chart-options",a.a,(function(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,1,"pp-scatter-chart-options",[],null,null,null,r,o)),i["\u0275did"](1,114688,null,0,a.a,[],null,null)],(function(t,e){t(e,1,0)}),null)}),{instanceKey:"instanceKey",hiddenOptions:"hiddenOptions"},{outShowSetting:"outShowSetting",outDownload:"outDownload",outOpenScatterPage:"outOpenScatterPage",outShowHelp:"outShowHelp"},[])},hNim:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("8Y7J");class a{constructor(){this.outApply=new i.EventEmitter,this.outCancel=new i.EventEmitter}ngOnInit(){}onApply(){this.min=Number.parseInt(this.minInput.nativeElement.value,10),this.max=Number.parseInt(this.maxInput.nativeElement.value,10),this.outApply.emit({key:this.instanceKey,min:this.min,max:this.max})}onCancel(){this.minInput.nativeElement.value=this.min,this.maxInput.nativeElement.value=this.max,this.outCancel.emit()}}},hiii:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("8Y7J");class a{constructor(){this.outShowSetting=new i.EventEmitter,this.outDownload=new i.EventEmitter,this.outOpenScatterPage=new i.EventEmitter,this.outShowHelp=new i.EventEmitter}ngOnInit(){}onShowHelp(t){this.outShowHelp.emit(t)}}},l5mm:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n("HDdC"),a=n("D0XW"),s=n("Y7HM");function o(t=0,e=a.a){return(!Object(s.a)(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=a.a),new i.a(n=>(n.add(e.schedule(r,t,{subscriber:n,counter:0,period:t})),n))}function r(t){const{subscriber:e,counter:n,period:i}=t;e.next(n),this.schedule({subscriber:e,counter:n+1,period:i},i)}},nZAD:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));class i{}},xvpG:function(t,e,n){"use strict";var i=n("f0Wu"),a=n("XNiG"),s=n("2Vo4");class o{constructor(t){this.options=t,this.initVar()}initVar(){const t=this.options.bubbleRadius;this.initFromX=this.options.x.from,this.widthOfChartSpace=this.options.width-(this.options.padding.left+this.options.padding.right)-2*t,this.heightOfChartSpace=this.options.height-(this.options.padding.top+this.options.padding.bottom)-2*t,this.calcuUnitValue()}calcuUnitValue(){this.timePerPixel=this.getGapX()/this.widthOfChartSpace,this.pixelPerTime=this.widthOfChartSpace/this.getGapX()}getInitFromX(){return this.initFromX}getLeftPadding(){return this.options.padding.left}getTopPadding(){return this.options.padding.top}getCanvasWidth(){return this.widthOfChartSpace}getWidth(){return this.options.width}getHeight(){return this.options.height}getX(){return{from:this.options.x.from,to:this.options.x.to}}resetInitX(t){this.initFromX=t}setX(t,e,n){this.options.x.from=t,this.options.x.to=e,this.calcuUnitValue()}getY(){return{from:this.options.y.from,to:this.options.y.to}}setY(t,e){this.options.y.from=t,this.options.y.to=e}getPadding(){return{top:this.options.padding.top,left:this.options.padding.left,right:this.options.padding.right,bottom:this.options.padding.bottom}}getBubbleHalfSize(){return this.options.bubbleRadius}getBubbleSize(){return 2*this.options.bubbleRadius}getWidthOfChartSpace(){return this.widthOfChartSpace}getHeightOfChartSpace(){return this.heightOfChartSpace}getPixelPerTime(){return this.pixelPerTime}getTimePerPixel(){return this.timePerPixel}parseXDataToXChart(t,e){return Math.round((t-this.options.x.from)/this.getGapX()*this.widthOfChartSpace)+this.getBubbleHalfSize()+(e?this.options.padding.left:0)}parseYDataToYChart(t){return Math.round(this.heightOfChartSpace-(t-this.options.y.from)/this.getGapY()*this.heightOfChartSpace)+this.getBubbleHalfSize()}parseZDataToZChart(t){return Math.round((t-this.options.z.from)/this.getGapZ()*this.getBubbleHalfSize())}getXOfPixel(){return Math.round(this.getGapX()/this.widthOfChartSpace)}getYOfPixel(){return Math.round(this.getGapY()/this.heightOfChartSpace)}parseMouseXToXData(t){return Math.round(t/this.widthOfChartSpace*this.getGapX())+this.options.x.from}parseMouseYToYData(t){return Math.round(this.options.y.from+t/this.heightOfChartSpace*this.getGapY())}getGapX(){return this.options.x.to-this.options.x.from}getGapY(){return this.options.y.to-this.options.y.from}getGapZ(){return this.options.z.to-this.options.z.from}}var r=n("/n0m");class l{constructor(t,e,n,i){this.options=t,this.coordinateManager=e,this.elementContainer=n,this.typeManager=i,this.initVariable(),this.initCanvasWrapper()}initVariable(){this.canvasMap={},this.ctxMap={}}initCanvasWrapper(){let t=100;const e=this.coordinateManager.getBubbleSize(),n=this.coordinateManager.getBubbleHalfSize(),i=this.coordinateManager.getWidthOfChartSpace(),a=this.coordinateManager.getHeightOfChartSpace();this.elementScroller=document.createElement("div"),this.elementScroller.setAttribute("style","top: 0px; left: 0px; position: absolute; background-color: grey; height:"+(a+e)+"px"),this.elementScroller.setAttribute("class","canvas-scroller");const s=document.createElement("div"),o=`\n            top: ${this.coordinateManager.getTopPadding()}px;\n            left: ${this.coordinateManager.getLeftPadding()+n}px;\n            width: ${i}px;\n            height: ${a+e}px;\n            z-index: ${t++};\n            overflow: hidden;\n            position: absolute;\n        `;s.setAttribute("class","canvas-wrapper"),s.setAttribute("style",o),s.appendChild(this.elementScroller),this.elementContainer.appendChild(s)}makeDataCanvas(t,e){let n=110;const i=this.coordinateManager.getBubbleSize(),a=this.options.prefix,s=this.coordinateManager.getHeightOfChartSpace(),o=this.coordinateManager.getCanvasWidth();e.forEach((t,e)=>{this.typeManager.getTypeNameList().forEach(e=>{const r=`${t}-${a}-${e}`;if(r in this.canvasMap==!1){const a=this.createCanvas({width:o+"px",height:s+i+"px","data-agent":t,"data-type":e,"data-key":r},`\n                        top: 0px;\n                        left: 0px;\n                        z-index: ${n++};\n                        position: absolute;\n                    `),l=this.createCanvas({width:o+"px",height:s+i+"px","data-agent":t,"data-type":e,"data-key":r},`\n                        top: 0px;\n                        left: ${o}px;\n                        z-index: ${n++};\n                        position: absolute;\n                    `);this.elementScroller.appendChild(a),this.elementScroller.appendChild(l),this.canvasMap[r]=[a,l],this.ctxMap[r]=[a.getContext("2d"),l.getContext("2d")]}})}),this.scrollOrder=[0,1]}createCanvas(t,e){const n=document.createElement("canvas");return Object.keys(t).forEach(e=>{n.setAttribute(e,t[e])}),n.setAttribute("style",e),n}setTypeView(t,e,n){const i=n?"block":"none";Object.keys(this.canvasMap).forEach(t=>{this.canvasMap[t].forEach(n=>{t.endsWith(e)&&(n.style.display=i)})})}toggle(t,e,n){Object.keys(this.canvasMap).forEach(i=>{this.canvasMap[i].forEach(a=>{(t||i.startsWith(e))&&i.endsWith(n)&&("none"===a.style.display?a.style.display="block":a.style.display="none")})})}showSelectedAgent(t){""===t?Object.keys(this.canvasMap).forEach(t=>{this.canvasMap[t].forEach(e=>{this.typeManager.isCheckedByName(t.split("-").pop())?e.style.display="block":e.style.display="none"})}):Object.keys(this.canvasMap).forEach(e=>{e.startsWith(t)?this.canvasMap[e].forEach(t=>{this.typeManager.isCheckedByName(e.split("-").pop())&&(t.style.display="block")}):this.canvasMap[e].forEach(t=>{t.style.display="none"})})}drawTransaction(t,e,n){const i=this.options.bubbleRadius,a=this.coordinateManager.getY();let s=(n[r.a.X]-this.coordinateManager.getInitFromX())*this.coordinateManager.getPixelPerTime();const o=this.coordinateManager.parseYDataToYChart(Math.min(a.to,Math.max(a.from,n[r.a.Y]))),l=this.coordinateManager.parseZDataToZChart(i);let h=this.scrollOrder[0];const c=this.coordinateManager.getCanvasWidth(),u=Math.round(parseInt(this.canvasMap[t][h].style.left,10)),d=u+c;s>d?(h=this.scrollOrder[1],s-=d):s-=u,this.ctxMap[t][h].beginPath(),this.ctxMap[t][h].fillStyle=e,this.ctxMap[t][h].strokeStyle=e,this.ctxMap[t][h].arc(s,o,l,0,2*Math.PI,!0),this.ctxMap[t][h].globalAlpha=.3+.1*n[r.a.GROUP_COUNT],this.ctxMap[t][h].fill()}moveChart(t,e){const n=this.coordinateManager.getCanvasWidth(),i=this.coordinateManager.getHeight(),a=parseInt(this.elementScroller.style.left,10),s=a-t,o=this;let r=-1;this.requestAnimationFrameRef=window.requestAnimationFrame(e=>{r=e,function t(e,l,h){const c=e-r;let u=c/h;if(u=Math.min(u,1),o.elementScroller.style.left=(a+-l*u).toFixed(2)+"px",c<h)o.requestAnimationFrameRef=window.requestAnimationFrame(e=>{t(e,l,h)});else{const t=o.scrollOrder[0],e=o.scrollOrder[1];let a=!1;Object.keys(o.canvasMap).forEach(r=>{const l=o.canvasMap[r];Math.abs(s)>parseInt(l[t].style.left,10)+n&&(a=!0,l[t].style.left=parseInt(l[e].style.left,10)+n+"px",o.ctxMap[r][t].clearRect(0,0,n,i))}),a&&(o.scrollOrder[0]=e,o.scrollOrder[1]=t)}}(e,t,300)})}reset(){window.cancelAnimationFrame(this.requestAnimationFrameRef),this.scrollOrder=[0,1],this.elementScroller.style.left="0px",this.elementScroller.innerHTML="",this.initVariable()}clear(){const t=this.coordinateManager.getCanvasWidth(),e=this.coordinateManager.getHeight();Object.keys(this.ctxMap).forEach(n=>{this.ctxMap[n].forEach(n=>{n.clearRect(0,0,t,e)})})}drawToCanvas(t,e){const n=this.coordinateManager.getPadding(),i=this.coordinateManager.getBubbleHalfSize();return Object.keys(this.canvasMap).forEach(a=>{this.canvasMap[a].forEach(a=>{"none"!==a.style.display&&t.drawImage(a,n.left+i,n.top+e)})}),t.textBaseline="top",t}}class h{constructor(t,e,n){this.options=t,this.coordinateManager=e,this.elementContainer=n,this.ticksX=this.options.ticks.x-1,this.ticksY=this.options.ticks.y-1,this.makeGridCanvas(),this.drawGridLine()}makeGridCanvas(){this.elementGridCanvas=document.createElement("canvas"),this.elementGridCanvas.setAttribute("width",this.coordinateManager.getWidth()+"px"),this.elementGridCanvas.setAttribute("height",this.coordinateManager.getHeight()+"px"),this.elementGridCanvas.setAttribute("style","top: 0px; z-index: 0; position: absolute"),this.elementContainer.appendChild(this.elementGridCanvas),this.ctxGridCanvas=this.elementGridCanvas.getContext("2d")}drawGridLine(){this.setStyle(this.ctxGridCanvas,this.options.gridAxisStyle),this.drawXGridLine(),this.drawYGridLine()}drawXGridLine(){const t=this.coordinateManager.getHeight(),e=this.coordinateManager.getPadding(),n=this.coordinateManager.getBubbleHalfSize(),i=this.coordinateManager.getWidthOfChartSpace()/this.ticksX,a=e.left+n,s=e.top,o=t-e.bottom;for(let r=0;r<=this.ticksX;r++){const t=a+i*r;this.drawLine(this.ctxGridCanvas,t,s,t,o)}}drawYGridLine(){const t=this.coordinateManager.getWidth(),e=this.coordinateManager.getHeight(),n=this.coordinateManager.getPadding(),i=this.coordinateManager.getBubbleHalfSize(),a=this.coordinateManager.getHeightOfChartSpace()/this.ticksY,s=n.left,o=t-n.right,r=n.bottom+i;for(let l=0;l<=this.ticksY;l++){const t=e-(r+a*l);this.drawLine(this.ctxGridCanvas,s,t,o,t)}}drawLine(t,e,n,i,a){t.beginPath(),this.moveTo(t,e,n),this.lineTo(t,i,a),t.stroke()}setStyle(t,e){Object.keys(e).forEach(n=>{"lineDash"===n?t.setLineDash(e[n]):t[n]=e[n]})}moveTo(t,e,n){e%1==0&&(e+=.5),n%1==0&&(n+=.5),t.moveTo(e,n)}lineTo(t,e,n){e%1==0&&(e+=.5),n%1==0&&(n+=.5),t.lineTo(e,n)}drawToCanvas(t,e){return t.drawImage(this.elementGridCanvas,0,e),t}}var c=n("eNwd"),u=n("l5mm"),d=n("LRne"),p=n("lJxs"),g=n("7o/Q");class m{constructor(t,e){this.predicate=t,this.inclusive=e}call(t,e){return e.subscribe(new f(t,this.predicate,this.inclusive))}}class f extends g.a{constructor(t,e,n){super(t),this.predicate=e,this.inclusive=n,this.index=0}_next(t){const e=this.destination;let n;try{n=this.predicate(t,this.index++)}catch(i){return void e.error(i)}this.nextOrComplete(t,n)}nextOrComplete(t,e){const n=this.destination;Boolean(e)?n.next(t):(this.inclusive&&n.next(t),n.complete())}}var x=n("GyhO");class b{constructor(t,e,n){this.options=t,this.coordinateManager=e,this.elementContainer=n,this.elementsAxisX=[],this.elementsAxisY=[],this.ticksX=this.options.ticks.x-1,this.ticksY=this.options.ticks.y-1,this.makeAxisCanvas(),this.drawAxisLine(),this.drawAxisValue(),this.updateAxisValue()}makeAxisCanvas(){this.elementAxisCanvas=document.createElement("canvas"),this.elementAxisCanvas.setAttribute("width",this.coordinateManager.getWidth()+"px"),this.elementAxisCanvas.setAttribute("height",this.coordinateManager.getHeight()+"px"),this.elementAxisCanvas.setAttribute("style","top: 0px; z-index: 10; position: absolute"),this.elementContainer.appendChild(this.elementAxisCanvas),this.ctxAxisCanvas=this.elementAxisCanvas.getContext("2d")}drawAxisLine(){const t=this.coordinateManager.getWidth(),e=this.coordinateManager.getHeight(),n=this.coordinateManager.getPadding(),i=this.coordinateManager.getBubbleHalfSize(),a=this.options.lineColor,s=this.options.gridAxisStyle,o=this.coordinateManager.getWidthOfChartSpace()/this.ticksX,r=this.coordinateManager.getHeightOfChartSpace()/this.ticksY,l=this.options.tickLength.x,h=this.options.tickLength.y;this.ctxAxisCanvas.lineWidth=s.lineWidth,this.ctxAxisCanvas.globalAlpha=1,this.ctxAxisCanvas.lineCap="round",this.ctxAxisCanvas.strokeStyle=a,this.ctxAxisCanvas.beginPath(),this.moveTo(this.ctxAxisCanvas,n.left,n.top),this.lineTo(this.ctxAxisCanvas,n.left,e-n.bottom),this.lineTo(this.ctxAxisCanvas,t-n.right,e-n.bottom),this.ctxAxisCanvas.stroke();for(let c=0;c<=this.ticksX;c++){const t=n.left+i+o*c;this.ctxAxisCanvas.beginPath(),this.moveTo(this.ctxAxisCanvas,t,e-n.bottom),this.lineTo(this.ctxAxisCanvas,t,e-n.bottom+l),this.ctxAxisCanvas.stroke()}for(let c=0;c<=this.ticksY;c++){const t=e-(n.bottom+i+r*c);this.ctxAxisCanvas.beginPath(),this.moveTo(this.ctxAxisCanvas,n.left,t),this.lineTo(this.ctxAxisCanvas,n.left-h,t),this.ctxAxisCanvas.stroke()}}moveTo(t,e,n){e%1==0&&(e+=.5),n%1==0&&(n+=.5),t.moveTo(e,n)}lineTo(t,e,n){e%1==0&&(e+=.5),n%1==0&&(n+=.5),t.lineTo(e,n)}drawAxisValue(){const t=this.coordinateManager.getWidthOfChartSpace()/this.ticksX,e=this.coordinateManager.getHeightOfChartSpace()/this.ticksY,n=this.coordinateManager.getWidth(),i=this.coordinateManager.getHeight(),a=this.coordinateManager.getPadding(),s=this.coordinateManager.getBubbleHalfSize(),o=this.options.axisColor;this.elementAxisContainer=document.createElement("div");const r=`top: 0px; width:${n}px ; height:${i}px ;cursor: corsshair; z-index: 10; position: absolute; background-color: rgba(0,0,0,0)`;this.elementAxisContainer.setAttribute("style",r),this.elementContainer.appendChild(this.elementAxisContainer);for(let c=0;c<=this.ticksX;c++){const e=document.createElement("div"),n=`\n                top: ${i-a.bottom+10}px;\n                left: ${a.left-t/2+c*t}px;\n                width: ${t}px;\n                color: ${o};\n                position: absolute;\n                text-align: center;\n            `;e.setAttribute("style",n+this.options.axisLabelStyle),e.textContent=" ",this.elementsAxisX.push(e),this.elementAxisContainer.appendChild(e)}for(let c=0;c<=this.ticksY;c++){const t=document.createElement("div"),n=`\n                top: ${s+c*e+a.top-10}px;\n                left: 0px;\n                width: ${a.left-10}px;\n                color: ${o};\n                position: absolute;\n                text-align: center;\n                vertical-align: middle;\n            `;t.setAttribute("style",n+this.options.axisLabelStyle),t.textContent=" ",this.elementsAxisY.push(t),this.elementAxisContainer.appendChild(t)}const l=this.options.axisUnit.x;if(""!==l){this.elementAxisXUnit=document.createElement("div");const t=`\n                top: ${i-a.bottom+10}px;\n                right: 80px;\n                color: ${o};\n                position: absolute;\n                text-align: right;\n            `;this.elementAxisXUnit.setAttribute("style",t+this.options.axisLabelStyle),this.elementAxisXUnit.textContent=l,this.elementAxisContainer.appendChild(this.elementAxisXUnit)}const h=this.options.axisUnit.y;if(""!==h){this.elementAxisYUnit=document.createElement("div");const t=`\n                top: 0px;\n                left: 10px;\n                color: ${o};\n                width: ${a.left-15};\n                position: absolute;\n                text-align: right;\n                vertical-align: middle;\n            `;this.elementAxisYUnit.setAttribute("style",t+this.options.axisLabelStyle),this.elementAxisYUnit.textContent=h,this.elementAxisContainer.appendChild(this.elementAxisYUnit)}}updateAxisValue(t,e){const n=this.coordinateManager.getX(),a=this.coordinateManager.getGapX()/this.ticksX;this.elementsAxisX.forEach((t,e)=>{const s=i(a*e+n.from).tz(this.options.timezone);t.innerHTML=s.format(this.options.dateFormat[0])+"<br>"+s.format(this.options.dateFormat[1])});const s=this.coordinateManager.getY(),o=this.coordinateManager.getGapY()/this.ticksY;this.elementsAxisY.forEach((t,e)=>{t.innerHTML=(s.to+s.from-(o*e+s.from)).toLocaleString()}),!0===t&&this.animateBackground(this.elementsAxisX[this.elementsAxisX.length-1],e)}animateBackground(t,e){const n=c.a.now();Object(u.a)(1,c.a).pipe(Object(p.a)(()=>(c.a.now()-n)/e),function(t,e=!1){return n=>n.lift(new m(t,e))}(t=>t<=1),function(...t){return e=>e.lift.call(Object(x.a)(e,...t))}(Object(d.a)(1))).subscribe(e=>{t.style.backgroundColor=`rgba(254, 255, 210, ${1-e}`})}drawToCanvas(t,e){let n=0;return t.drawImage(this.elementAxisCanvas,0,e),t.textAlign="center",this.elementsAxisX.forEach(i=>{t.font=i.style.font,t.fillStyle=i.style.color,i.innerHTML.replace(/<br>/gi," ").split(" ").forEach((n,a)=>{t.fillText(n,parseInt(i.style.left,10)+i.getBoundingClientRect().width/2,parseInt(i.style.top,10)+15*(a+1)+e)}),n=Math.max(n,parseInt(i.style.left,10))}),t.textAlign="right",this.elementsAxisY.forEach(n=>{t.font=n.style.font,t.fillStyle=n.style.color,t.fillText(n.textContent,n.getBoundingClientRect().width-10,parseInt(n.style.top,10)+15+ +e)}),""!==this.options.axisUnit.x&&this.elementAxisXUnit&&(t.textAlign="right",t.font=this.elementAxisXUnit.style.fontFamily,t.fillStyle=this.elementAxisXUnit.style.color,t.fillText(this.elementAxisXUnit.textContent,n+this.elementAxisXUnit.getBoundingClientRect().width,parseInt(this.elementAxisXUnit.style.top,10)+30+e)),""!==this.options.axisUnit.y&&this.elementAxisYUnit&&(t.textAlign="right",t.font=this.elementAxisYUnit.style.fontFamily,t.fillStyle=this.elementAxisYUnit.style.color,t.fillText(this.elementAxisYUnit.textContent,parseInt(this.elementAxisYUnit.style.left,10)+this.elementAxisYUnit.getBoundingClientRect().width,10+e)),t}reset(){this.updateAxisValue()}}var y=n("REft"),C=n("gb1L");class A{constructor(t,e,n){this.options=t,this.coordinateManager=e,this.elementContainer=n,this.browserName=Object(C.a)().browser.name,this.outDragArea=new a.b,this.onDragArea$=this.outDragArea.asObservable();const i=this.coordinateManager.getPadding(),s=this.coordinateManager.getWidth()-i.left-i.right,o=this.coordinateManager.getHeight()-i.top-i.bottom;this.initWrapperElement(s,o),this.initXLabelElement(o,10),this.initYLabelElement(i.left,10),this.initDragElement(),this.initEvent()}initWrapperElement(t,e){this.elementAxisWrapper=document.createElement("div"),this.elementAxisWrapper.setAttribute("style",`\n            top: ${this.coordinateManager.getTopPadding()}px;\n            left: ${this.coordinateManager.getLeftPadding()}px;\n            width: ${t}px;\n            height: ${e}px;\n            cursor: crosshair;\n            z-index: 600;\n            position: absolute;\n            user-select: none;\n            background-color: rgba(0,0,0,0);\n        `),this.elementAxisWrapper.setAttribute("class","overlay"),this.elementContainer.appendChild(this.elementAxisWrapper)}initXLabelElement(t,e){this.elementXAxisLabelWrapper=document.createElement("div"),this.elementXAxisLabelWrapper.draggable=!1,this.elementXAxisLabelWrapper.setAttribute("style",`\n            top: ${t+e}px;\n            left: 0px;\n            color: #FFF;\n            width: 80px;\n            display: none;\n            position: absolute;\n            text-align: center;\n            background: #000;\n            user-select: none;\n            font-family: monospace;\n            margin-left: -28px;\n        `+this.options.axisLabelStyle),this.elementXAxisLabel=document.createElement("span");const n=document.createElement("div");n.setAttribute("style",`\n            top: ${-e}px;\n            left: 27px;\n            height: ${e}px;\n            position: absolute;\n            border-left: 1px solid red;\n        `),this.elementXAxisLabelWrapper.appendChild(this.elementXAxisLabel),this.elementXAxisLabelWrapper.appendChild(n),this.elementAxisWrapper.appendChild(this.elementXAxisLabelWrapper)}initYLabelElement(t,e){this.elementYAxisLabelWrapper=document.createElement("div"),this.elementYAxisLabelWrapper.draggable=!1,this.elementYAxisLabelWrapper.setAttribute("style",`\n            top: 0px;\n            left: ${-(t-2)}px;\n            color: #fff;\n            width: ${t-2-e}px;\n            display: none;\n            position: absolute;\n            margin-top: ${-e}px;\n            text-align: right;\n            background: #000;\n            font-family: monospace;\n            padding-right: 3px;\n            vertical-align: middle;\n        `+this.options.axisLabelStyle),this.elementYAxisLabel=document.createElement("span");const n=document.createElement("div");n.setAttribute("style",`\n            top: 9px;\n            right: -10px;\n            width: ${e}px;\n            position: absolute;\n            border-top: 1px solid red;\n        `),this.elementYAxisLabelWrapper.appendChild(this.elementYAxisLabel),this.elementYAxisLabelWrapper.appendChild(n),this.elementAxisWrapper.appendChild(this.elementYAxisLabelWrapper)}initDragElement(){this.elementDragWrapper=document.createElement("div"),this.elementDragWrapper.setAttribute("style",`\n            touch-action: none;\n            top: 0px;\n            left: 0px;\n            width: ${this.coordinateManager.getWidth()}px;\n            height: ${this.coordinateManager.getHeight()}px;\n            cursor: crosshair;\n            z-index: 601;\n            position: absolute;\n            background-color: rgba(0,0,0,0);\n        `),this.elementDragArea=document.createElement("div"),this.elementDragArea.setAttribute("style","\n            width: 0px;\n            height: 0px;\n            display: none;\n            position: absolute;\n            border: 1px solid #469AE4;\n            background-color: rgba(237, 242, 248, 0.5);\n        "),this.elementDragWrapper.appendChild(this.elementDragArea),this.elementContainer.appendChild(this.elementDragWrapper)}initEvent(){const t=this.coordinateManager.getPadding(),e=this.coordinateManager.getWidth(),n=this.coordinateManager.getHeight(),i={leftRevision:this.coordinateManager.getBubbleHalfSize()+t.left,width:e-this.coordinateManager.getBubbleHalfSize()+t.left-t.right,topRevision:t.top,height:n-t.top-t.bottom-this.coordinateManager.getBubbleHalfSize()};let a=!1,s=0,o=0,r=0,l=0,h=-1,c=-1,u=0,d=0;function p(t){if(a=!1,this.elementDragArea.style.display="none",t){const t=(r>=s?s:r)-i.leftRevision,e=(r>=s?r:s)-i.leftRevision,n=(l>=o?l:o)-i.topRevision,a=(l>=o?o:l)-i.topRevision;this.outDragArea.next({x:{from:Math.max(t,0),to:Math.min(e,i.width)},y:{from:Math.max(i.height-n,0),to:Math.min(i.height-a,i.height)}})}this.elementDragArea.style.top="0px",this.elementDragArea.style.left="0px",this.elementDragArea.style.width="0px",this.elementDragArea.style.height="0px",h=-1,c=-1}function g(t){t.preventDefault()}["mousedown","touchstart"].forEach(t=>{this.elementDragWrapper.addEventListener(t,t=>{const e=t.type.startsWith("touch");let n,i;if(e){document.body.addEventListener("touchmove",g,{passive:!1});const e=t,a=e.target.offsetParent.getBoundingClientRect();u=e.touches[0].clientX,d=e.touches[0].clientY,n=u-a.left,i=d-a.top}else if("safari"===this.browserName){const e=t.target.offsetParent.getBoundingClientRect();n=u-e.left,i=d-e.top}else{const e=t;n=e.offsetX,i=e.offsetY}a=!0,s=r=n,o=l=i,this.elementDragArea.style.display="block",this.elementDragArea.style.top=o+"px",this.elementDragArea.style.left=s+"px",!1===e&&t.preventDefault()})}),["mouseup","touchend"].forEach(t=>{this.elementDragWrapper.addEventListener(t,t=>{const e=t.type.startsWith("touch");p.call(this,!0),!1===e?t.preventDefault():document.body.removeEventListener("touchmove",g)})}),["mousemove","touchmove"].forEach(t=>{this.elementDragWrapper.addEventListener(t,t=>{const p=t.type.startsWith("touch");let g,m;if(p){const e=t;g=e.touches[0].clientX-u,m=e.touches[0].clientY-d,u=e.touches[0].clientX,d=e.touches[0].clientY}else if("safari"===this.browserName){const e=t;g=e.clientX-u,m=e.clientY-d,u=e.clientX,d=e.clientY}else{const e=t;g=e.movementX,m=e.movementY}r+=g,l+=m,a?(this.checkAxisLabel(r,l,i),h!==r&&r<=e&&(r>=s?(this.elementDragArea.style.left=s+"px",this.elementDragArea.style.width=r-s+"px"):(this.elementDragArea.style.left=r+"px",this.elementDragArea.style.width=s-r+"px"),h=r),c!==l&&l<=n&&(l>=o?(this.elementDragArea.style.top=o+"px",this.elementDragArea.style.height=l-o+"px"):(this.elementDragArea.style.top=l+"px",this.elementDragArea.style.height=o-l+"px"),c=l)):this.checkAxisLabel(g,m,i),!1===p&&t.preventDefault()})}),this.elementDragWrapper.addEventListener("mouseleave",t=>(p.call(this,!1),this.hideAxisLabel(),t.preventDefault(),!1))}checkAxisLabel(t,e,n){if(!this.options.showMouseGuideLine)return;const i=t-n.leftRevision,a=e-n.topRevision;i>=0&&i<=n.width||a>=0&&a<=n.height?(i>=0&&i<=n.width?this.showXAxisLabel():this.hideXAxisLabel(),a>=0&&a<=n.height?this.showYAxisLabel():this.hideYAxisLabel(),this.setAndMoveAxisLabel(i,a)):this.hideAxisLabel()}setAndMoveAxisLabel(t,e){const n=this.coordinateManager.getHeight(),a=this.coordinateManager.getPadding(),s=this.coordinateManager.getBubbleHalfSize(),o=i(this.coordinateManager.parseMouseXToXData(t-s)).tz(this.options.timezone).format(this.options.dateFormat[1]),r=this.coordinateManager.parseMouseYToYData(n-e-a.bottom-a.top-s);this.elementXAxisLabel.textContent=o,this.elementYAxisLabel.textContent=r.toLocaleString(),this.elementXAxisLabelWrapper.style.left=t+s+"px",this.elementYAxisLabelWrapper.style.top=e+s+"px"}showXAxisLabel(){this.elementXAxisLabelWrapper.style.display="block"}showYAxisLabel(){this.elementYAxisLabelWrapper.style.display="block"}showAxisLabel(){this.showXAxisLabel(),this.showYAxisLabel()}hideXAxisLabel(){this.elementXAxisLabelWrapper.style.display="none"}hideYAxisLabel(){this.elementYAxisLabelWrapper.style.display="none"}hideAxisLabel(){this.hideXAxisLabel(),this.hideYAxisLabel()}}n.d(e,"a",(function(){return v}));class v{constructor(t,e,n,i,o,r,l,h,c,u,d,p){this.mode=t,this.element=e,this.fromX=n,this.toX=i,this.fromY=o,this.toY=r,this.application=l,this.width=c,this.height=u,this.timezone=d,this.dateFormat=p,this.dataBlocks=[],this.agentList=[],this.selectedAgent="",this.outSelect=new a.b,this.outError=new a.b,this.outChangeRangeX=new a.b,this.downloadElement=document.createElement("a"),this.selectedAgent=h,this.setOptions(),this.initManagers(),this.onSelect$=this.outSelect.asObservable(),this.onError$=this.outError.asObservable(),this.onChangeRangeX$=this.outChangeRangeX.asObservable(),this.outTransactionCount=new s.a(this.getTransactionCount(!0)),this.onChangeTransactionCount$=this.outTransactionCount.asObservable()}isAllowedAgent(t,e){return""===t||t===e}getTransactionCount(t){const e={},n=this.coordinateManager.getX();return this.typeManager.getTypeNameList().forEach(t=>{e[t]={count:0,checked:this.typeManager.isCheckedByName(t)}}),!1===t&&this.typeManager.getTypeNameList().forEach(t=>{e[t].count=0,this.dataBlocks.forEach(i=>{if(i.getXRange().to>=n.from){i.getAgentList().forEach(a=>{this.isAllowedAgent(this.selectedAgent,a)&&(e[t].count+=i.getCount(a,t,n.from,n.to))})}})}),e}setOptions(){this.options={mode:this.mode,prefix:"scatter-chart-"+1e4*Math.random(),width:this.width,height:this.height,bubbleRadius:3,padding:{top:20,left:60,right:40,bottom:40},axisLabelStyle:"font-size:10px; line-height: 12px; padding-top: 3px",axisColor:"#000",lineColor:"#3D3D3D",x:{from:this.fromX,to:this.toX},y:{from:this.fromY,to:this.toY},z:{from:0,to:5},ticks:{x:5,y:5},tickLength:{x:10,y:10},gridAxisStyle:{lineDash:[1,0],lineWidth:1,globalAlpha:1,strokeStyle:"#e3e3e3"},axisUnit:{x:"",y:"(ms)"},showMouseGuideLine:!0,animationDuration:300,timezone:this.timezone,dateFormat:this.dateFormat}}initManagers(){this.typeManager=new y.a(y.a.getDefaultTransactionTypeInfo()),this.coordinateManager=new o(this.options),this.gridRenderer=new h(this.options,this.coordinateManager,this.element),this.axisRenderer=new b(this.options,this.coordinateManager,this.element),this.rendererManager=new l(this.options,this.coordinateManager,this.element,this.typeManager),this.mouseManager=new A(this.options,this.coordinateManager,this.element),this.mouseManager.onDragArea$.subscribe(t=>{const e=this.coordinateManager.parseMouseXToXData(t.x.from),n=this.coordinateManager.parseMouseXToXData(t.x.to),i=this.coordinateManager.parseMouseYToYData(t.y.from),a=this.coordinateManager.parseMouseYToYData(t.y.to);this.hasDataByXY(e,n,i,a)&&this.outSelect.next({x:{from:e,to:n},y:{from:i,to:a},drag:t,type:this.typeManager.getCheckedTypeNameList(),agent:this.selectedAgent})})}changeShowType(t){this.typeManager.setChecked(t.name,t.checked),this.rendererManager.setTypeView(this.selectedAgent,t.name,t.checked)}redrawDataBlock(){this.dataBlocks.forEach(t=>{this.drawDataBlock(t)})}reset(t,e,n,i,a,s){this.fromX=n,this.toX=i,this.options.mode=this.mode=a,this.coordinateManager.resetInitX(n),this.coordinateManager.setX(n,i),this.typeManager.reset(),this.application=t,this.selectedAgent=e,this.dataBlocks=[],this.agentList=[],this.axisRenderer.reset(),this.rendererManager.reset(),s&&this.changeShowType(s),this.outTransactionCount.next(this.getTransactionCount(!0))}addAgent(t){t.forEach(t=>{-1===this.agentList.lastIndexOf(t)&&this.agentList.push(t)}),this.agentList.sort()}addData(t,e){const n=this.coordinateManager.getX(),i=t.getXRange();this.options.mode===v.MODE.STATIC&&i.from>=n.to||(this.addAgent(t.getAgentList()),this.dataBlocks.push(t),this.drawDataBlock(t),this.options.mode!==v.MODE.STATIC&&(this.moveChart(t,e||300),this.removeBubble()),this.changeSelectedAgent(this.selectedAgent))}drawDataBlock(t){const e=this.options.prefix;this.rendererManager.makeDataCanvas(t,t.getAgentList()),this.agentList.forEach(n=>{for(let i=0,a=t.countByAgent(n);i<a;i++){const a=t.getDataByAgentAndIndex(n,i);if(0!==t.getGroupCount(a)){const i=t.getTypeIndex(a),s=this.typeManager.getNameByIndex(i),o=this.typeManager.getColorByIndex(i);this.rendererManager.drawTransaction(`${n}-${e}-${s}`,o,a)}}})}moveChart(t,e){const n=this.coordinateManager.getX(),i=t.getXRange(),a=this.options.animationDuration;if(i.from>=n.to){const t=i.to-n.to,s=t*this.coordinateManager.getPixelPerTime();this.coordinateManager.setX(n.from+t,n.to+t),this.axisRenderer.updateAxisValue(!0,2*a),this.rendererManager.moveChart(Math.floor(s),e<a?0:a),this.outChangeRangeX.next({from:n.from+t,to:n.to+t})}}removeBubble(){const t=this.coordinateManager.getX().from;for(let e=0;e<this.dataBlocks.length;e++){if(!(this.dataBlocks[e].getXRange().to<t))break;this.dataBlocks.shift(),e--}}getDataByRange(t,e,n,i,a,s){t=+t,e=+e,n=+n,i=+i;const o=[],r=this.coordinateManager.getY(),l={};s.forEach(t=>{l[t]=!0});for(let h=0;h<this.dataBlocks.length;h++){const s=this.dataBlocks[h];for(let h=0,c=s.getTotalCount();h<c;h++){const c=s.getXRange();if(c.to<t||c.from>e)continue;const u=s.getDataByIndex(h),d=s.getAgentName(u);if(this.isAllowedAgent(a,d)){const a=s.getX(u),h=s.getY(u);this.isInRange(t,e,a)&&(this.isInRange(n,i,h)||h>i&&i>=r.to||h<n&&n<=r.from)&&!0===l[this.typeManager.getNameByIndex(s.getTypeIndex(u))]&&o.push([s.getTransactionID(u),a,h])}}}return o}hasDataByXY(t,e,n,i){t=+t,e=+e,n=+n,i=+i;const a=this.coordinateManager.getY();for(let s=0;s<this.dataBlocks.length;s++){const o=this.dataBlocks[s];for(let s=0,r=o.getTotalCount();s<r;s++){const r=o.getDataByIndex(s),l=o.getAgentName(r);if(this.isAllowedAgent(this.selectedAgent,l)){const s=o.getX(r),l=o.getY(r);if(this.isInRange(t,e,s)&&(this.isInRange(n,i,l)||l>i&&i>=a.to||l<n&&n<=a.from)&&this.typeManager.isCheckedByIndex(o.getTypeIndex(r)))return!0}}}return!1}isInRange(t,e,n){return n>=t&&n<=e}downloadChartAsImage(t){const e=this.coordinateManager.getX(),n=this.coordinateManager.getWidth(),a=this.coordinateManager.getHeight()+60+40,s=document.createElement("canvas");s.setAttribute("width",n+"px"),s.setAttribute("height",a+"px");const o=s.getContext("2d");o.fillStyle="#FFFFFF",o.fillRect(0,0,n,a),this.gridRenderer.drawToCanvas(o,60),this.axisRenderer.drawToCanvas(o,60),this.rendererManager.drawToCanvas(o,60),o.textAlign="left",o.font="24px monospace",o.fillText(this.application,10,10),o.font="14px monospace",o.fillText(i(e.from).tz(this.timezone).format(this.dateFormat[0]+" "+this.dateFormat[1])+" ~ "+i(e.to).tz(this.timezone).format(this.dateFormat[0]+" "+this.dateFormat[1]),10,40),this.typeManager.getTypeNameList().forEach((t,e)=>{const n=this.typeManager.getColorByName(t),i=this.typeManager.isCheckedByName(t);let s=0;this.dataBlocks.forEach(e=>{s+=e.getCount(this.selectedAgent,t)}),o.textAlign="left",o.font="16px monospace",i?(o.fillStyle=n,o.fillRect(200*e+10,a-40+10,20,20)):(o.lineWidth=4,o.strokeStyle=n,o.strokeRect(200*e+10,a-40+10,20,20)),o.fillStyle="#000",o.fillText(`${t} : ${s}`,200*e+40,a-40+10)}),this.downloadElement.setAttribute("href",s.toDataURL("image/"+t)),this.downloadElement.setAttribute("download",`Pinpoint_Scatter_Chart[${i(e.from).tz(this.timezone).format(this.dateFormat[0]+"_"+this.dateFormat[1])}~${i(e.to).tz(this.timezone).format(this.dateFormat[0]+"_"+this.dateFormat[1])}].png`),this.downloadElement.dispatchEvent(new MouseEvent("click"))}redraw(){this.rendererManager.clear(),this.axisRenderer.updateAxisValue(),this.redrawDataBlock()}changeYRange(t){this.fromY=+t.from,this.toY=+t.to,this.coordinateManager.setY(+t.from,+t.to),this.redraw()}changeSelectedAgent(t){this.selectedAgent=t,this.rendererManager.showSelectedAgent(t),this.outTransactionCount.next(this.getTransactionCount(!1))}getCurrentAgent(){return this.selectedAgent}isEmpty(){if(this.options.mode===v.MODE.STATIC){let t=!0;return this.dataBlocks.forEach(e=>{t=t&&e.isEmpty()}),t}return!1}getTypeManager(){return this.typeManager}setTimezone(t){this.options.timezone=this.timezone=t}setDateFormat(t){this.options.dateFormat=this.dateFormat=t}}v.MODE={REALTIME:"realtime",STATIC:"static"}},zw4y:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("2Vo4"),a=n("XNiG");class s{constructor(){this.outChartData=new i.a({instanceKey:"",data:null}),this.outViewType=new a.b,this.outChangeYRange=new a.b,this.outSelectedAgent=new a.b,this.outInvokeDownloadChart=new a.b,this.outReset=new a.b,this.outError=new a.b,this.onChartData$=this.outChartData.asObservable(),this.onViewType$=this.outViewType.asObservable(),this.onChangeYRange$=this.outChangeYRange.asObservable(),this.onSelectedAgent$=this.outSelectedAgent.asObservable(),this.onInvokeDownloadChart$=this.outInvokeDownloadChart.asObservable(),this.onReset$=this.outReset.asObservable(),this.onError$=this.outError.asObservable()}addChartData(t,e){this.outChartData.next({instanceKey:t,data:e})}changeViewType(t){this.outViewType.next(t)}changeYRange(t){this.outChangeYRange.next(t)}changeAgent(t,e){this.outSelectedAgent.next({instanceKey:t,agent:e})}downloadChart(t){this.outInvokeDownloadChart.next(t)}reset(t,e,n,i,a,s){this.outReset.next({instanceKey:t,application:e,agent:n,from:i,to:a,mode:s})}setError(t){this.outError.next(t)}}}}]);